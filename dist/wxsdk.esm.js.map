{"version":3,"file":"wxsdk.esm.js","sources":["../src/router.js","../src/utils.js","../src/core.js","../src/overide/wx.js","../src/handle-config/index.js","../src/overide/index.js","../src/index.js"],"sourcesContent":["// 处理路由跳转相关数据\r\nexport default class Router {\r\n  constructor (sdk) {\r\n    this.sdk = sdk\r\n  }\r\n}","export const warn = (message, isWarn) => {\r\n  message = `\\n[ReportSDK warn]: ${message}\\n\\n`\r\n  if (isWarn) {\r\n    console.warn(message)\r\n    return\r\n  }\r\n  throw new Error(message)\r\n}\r\n\r\nexport const assert = (condition, error) => {\r\n  if (condition) {\r\n    warn(error)\r\n  }\r\n}\r\n\r\nexport const isUndef = v => {\r\n  return v === null || v === undefined\r\n}\r\n\r\nexport const once =  (fn) => {\r\n  let first = true\r\n  return function (...args) {\r\n    if (!first) return\r\n    first = false\r\n    fn.apply(this, args)\r\n  }\r\n}\r\n\r\nexport const callHook = (hooks, name, params) => {\r\n  if (hooks && typeof hooks[name] === 'function') {\r\n    return hooks[name].apply(hooks, params)\r\n  }\r\n  return null\r\n}\r\n\r\nexport const remove = (list, item) => {\r\n  const index = list.indexOf(item)\r\n  if (~index) {\r\n    list.splice(index, 1)\r\n  }\r\n}\r\n\r\nexport const createWraper = (target, fn) => {\r\n  return function (...args) {\r\n    fn.apply(this, args)\r\n    if (typeof target === 'function') {\r\n      return target.apply(this, args)\r\n    }\r\n  }\r\n}\r\n\r\nexport const isPlainObject = obj => {\r\n  if (typeof obj !== 'object' || obj === null) return false\r\n\r\n  const proto = Object.getPrototypeOf(obj)\r\n  if (proto === null) return true\r\n\r\n  let baseProto = proto\r\n  while (Object.getPrototypeOf(baseProto) !== null) {\r\n    baseProto = Object.getPrototypeOf(baseProto)\r\n  }\r\n  return proto === baseProto\r\n}\r\n","import Router from './router'\r\nimport { warn, assert, isUndef, callHook } from './utils'\r\n\r\nexport default class SDK {\r\n  constructor (opts) {\r\n    this.opts = opts\r\n    this.reportStack = {}\r\n    this.hooks = opts.hooks\r\n    this.depComponents = new Map()\r\n    this.router = new Router(this)\r\n    this.timeStack = Object.create(null)\r\n  }\r\n\r\n  time (type) {\r\n    if (typeof type === 'string') {\r\n      if (isUndef(this.timeStack[type])) {\r\n        this.timeStack[type] = Date.now()\r\n      } else {\r\n        warn(`Timer [${type}] already exists.`, true)\r\n      }\r\n    }\r\n  }\r\n\r\n  timeEnd (type, fn) {\r\n    if (typeof type === 'string') {\r\n      if (!isUndef(this.timeStack[type])) {\r\n        const duration = Date.now() - this.timeStack[type]\r\n        typeof fn === 'function' && fn(duration)\r\n        this.timeStack[type] = null\r\n        return duration\r\n      }\r\n    } else {\r\n      warn(`Timer [${type}] does not exist.`, true)\r\n    }\r\n    return null\r\n  }\r\n\r\n  // 调用数据上报的钩子\r\n  // 网络请求等具体的副作用暴露给外部\r\n  report (key, payload) {\r\n    if (isUndef(this.reportStack[key])) {\r\n      this.reportStack[key] = [payload]\r\n      // 延迟 200ms 做批量上报\r\n      setTimeout(() => {\r\n        callHook(this.hooks, 'report', [key, this.reportStack[key]])\r\n        this.reportStack[key] = null\r\n      }, 200)\r\n    } else {\r\n      this.reportStack[key].push(payload)\r\n    }\r\n  }\r\n}\r\n","import { createWraper } from '../utils'\r\n\r\n// 获取当前页面\r\nconst getCurrentPagePath = () => {\r\n  const pages = getCurrentPages()\r\n  return Array.isArray(pages) && pages.length > 0\r\n    ? pages[pages.length - 1].route\r\n    : null\r\n}\r\n\r\nconst handleRouter = (routerType, sdk, opts = {}) => {\r\n  const { fail, success } = opts\r\n  const info = {\r\n    routerType,\r\n    to: opts.url,\r\n    from: getCurrentPagePath(),\r\n  }\r\n\r\n  // 路由跳转成功\r\n  opts.success = createWraper(\r\n    success,\r\n    () => sdk.report('router', info),\r\n  )\r\n\r\n  // 路由跳转发生错误\r\n  opts.fail = createWraper(\r\n    fail,\r\n    error => {\r\n      info.error = error\r\n      sdk.report('routerError', info)\r\n    },\r\n  )\r\n}\r\n\r\nexport default (sdk, rewrite) => {\r\n  // 导航相关方法\r\n  rewrite('reLaunch', opts => handleRouter('reLaunch', sdk, opts))\r\n  rewrite('switchTab', opts => handleRouter('switchTab', sdk, opts))\r\n  rewrite('navigateTo', opts => handleRouter('navigateTo', sdk, opts))\r\n  rewrite('redirectTo', opts => handleRouter('redirectTo', sdk, opts))\r\n}","import { warn } from \"../utils\";\r\n\r\nexport function onLoad(sdk, currentComponent, SDKConfig, isPage) {\r\n    // SDKConfig.onLoad.report1.fn.call(sdk, component)\r\n    const onLoadFns = SDKConfig.onLoad\r\n    for (const key in onLoadFns) {\r\n        if (onLoadFns.hasOwnProperty(key) && typeof onLoadFns[key] === 'function') {\r\n            onLoadFns[key](sdk, currentComponent)\r\n        }\r\n    }\r\n}\r\n\r\nexport function onShow(sdk, currentComponent, SDKConfig, isPage) {\r\n    const onShowFns = SDKConfig.onShow\r\n    for (const key in onShowFns) {\r\n        if (onShowFns.hasOwnProperty(key) && typeof onShowFns[key] === 'function') {\r\n            onShowFns[key](sdk, currentComponent)\r\n        }\r\n    }\r\n}\r\n\r\nexport function unLoad(sdk, component, SDKConfig, isPage) {\r\n\r\n}\r\n","import overideWX from './wx'\r\nimport {onLoad, onShow, unLoad} from '../handle-config'\r\nimport {createWraper, isPlainObject, assert, callHook} from '../utils'\r\n\r\nexport const SDKCfgNamespace = 'SDKConfig'\r\n\r\n/**\r\n * 数据统计的具体实现思路\r\n *  1. 需要对各种时长进行统计\r\n *  2. 对页面点击的埋点统计\r\n *  3. 自定业务逻辑的埋点统计\r\n *  4. 向外暴露的 api\r\n */\r\n\r\n// 重写 component 和 page 的 config\r\nexport function overideComponent(sdk, config, isPage) {\r\n    const SDKConfig = config[SDKCfgNamespace]\r\n    const canProcessCfg = isPlainObject(SDKConfig)\r\n\r\n    // Page\r\n    if (isPage) {\r\n        const nativeLoad = config.onLoad\r\n        const nativeOnShow = config.onShow\r\n        const nativeUnload = config.onUnload\r\n\r\n        // rewritte load hooks\r\n        config.onLoad = createWraper(\r\n            nativeLoad,\r\n            function () {\r\n                sdk.depComponents.set(this, true)\r\n                if (canProcessCfg) {\r\n                    this[SDKCfgNamespace] = SDKConfig\r\n                    onLoad(sdk, this, SDKConfig, true)\r\n                }\r\n            },\r\n        )\r\n\r\n        config.onShow = createWraper(\r\n            nativeOnShow,\r\n            function () {\r\n                if (canProcessCfg) {\r\n                    this[SDKCfgNamespace] = SDKConfig\r\n                    onShow(sdk, this, SDKConfig, true)\r\n                }\r\n            }\r\n        )\r\n\r\n        // rewritte unload hook\r\n        config.onUnload = createWraper(\r\n            nativeUnload,\r\n            function () {\r\n                sdk.depComponents.delete(this)\r\n                if (canProcessCfg) {\r\n                    unLoad(sdk, this, SDKConfig, true)\r\n                    this[SDKCfgNamespace] = null\r\n                }\r\n            },\r\n        )\r\n    } else {\r\n        // Component\r\n        config.lifetimes = config.lifetimes || {}\r\n        const nativeAttached = config.attached || config.lifetimes.attached\r\n        const nativeDetached = config.detached || config.lifetimes.detached\r\n\r\n        config.attached = config.lifetimes.attached = createWraper(\r\n            nativeAttached,\r\n            function () {\r\n                sdk.depComponents.set(this, false)\r\n                if (canProcessCfg) {\r\n                    this[SDKCfgNamespace] = SDKConfig\r\n                    load(sdk, this, SDKConfig, true)\r\n                }\r\n            },\r\n        )\r\n\r\n        config.detached = config.lifetimes.detached = createWraper(\r\n            nativeDetached,\r\n            function () {\r\n                sdk.depComponents.delete(this)\r\n                if (canProcessCfg) {\r\n                    unLoad(sdk, this, SDKConfig, true)\r\n                    this[SDKCfgNamespace] = null\r\n                }\r\n            },\r\n        )\r\n    }\r\n    return config\r\n}\r\n\r\n// 重写 app 的 config\r\nexport function overideApp(sdk, config) {\r\n    const nativeShow = config.onShow\r\n    const nativeHide = config.onHide\r\n    const nativeError = config.onError\r\n\r\n    config.onShow = createWraper(\r\n        nativeShow,\r\n        function () {\r\n            // 记录当前 app 从显示到隐藏，一共停留的时长\r\n            sdk.time('showTime')\r\n            // 记录初始化的时长\r\n            const duration = sdk.timeEnd('startTime')\r\n            sdk.report('startTime', duration)\r\n\r\n        },\r\n    )\r\n\r\n    config.onHide = createWraper(\r\n        nativeHide,\r\n        function () {\r\n            const duration = sdk.timeEnd('showTime')\r\n            sdk.report('showTime', duration)\r\n        },\r\n    )\r\n\r\n    config.onError = createWraper(\r\n        nativeError,\r\n        function (errMsg) {\r\n            // 自动上报在 app 里面捕获到的错误\r\n            sdk.report('globalCatchError', errMsg)\r\n            callHook(sdk.hooks, 'ddd', [1, 2, 3])\r\n        },\r\n    )\r\n\r\n    return config\r\n}\r\n\r\n// 重写 wx 类\r\nexport function overideWxClass(sdk, nativeWX) {\r\n    const overideClass = {}\r\n\r\n    overideWX(sdk, (name, fn) => {\r\n        // 只允许重写，不允许新增\r\n        // 如果需要新增全局方法，不应该写在这里\r\n        assert(!(name in nativeWX), 'Only allowed to rewrite.')\r\n        assert(name in overideClass, `${name} has been rewritten`)\r\n        overideClass[name] = createWraper(nativeWX[name], fn)\r\n    })\r\n\r\n    wx = Object.assign({}, nativeWX, overideClass)\r\n}\r\n","import SDK from './core'\r\nimport { warn } from './utils'\r\nimport { overideApp, overideComponent, overideWxClass } from './overide'\r\n\r\nlet isInitComplete = false\r\n\r\nconst nativeWX = wx\r\nconst nativeApp = App\r\nconst nativePage = Page\r\nconst nativeComponent = Component\r\n\r\nconst filterOpts = opts => {\r\n  return Object.assign(\r\n    {\r\n      hooks: {\r\n        report () {\r\n          warn('you need defined [report] hook function.')\r\n        },\r\n      },\r\n    },\r\n    opts,\r\n  )\r\n}\r\n\r\nexport default function (opts) {\r\n  if (isInitComplete) {\r\n    warn('Can\\'t allow repeat initialize.')\r\n  }\r\n\r\n  const sdk = new SDK(filterOpts(opts || {}))\r\n\r\n  // 记录项目启动时的时机点\r\n  sdk.time('startTime')\r\n\r\n  Page = function (config) {\r\n    config = overideComponent(sdk, config, true)\r\n    return nativePage.call(this, config)\r\n  }\r\n  Component = function (config) {\r\n    config = overideComponent(sdk, config, false)\r\n    return nativeComponent.call(this, config)\r\n  }\r\n  App = function (config) {\r\n    config = overideApp(sdk, config)\r\n    return nativeApp.call(this, config)\r\n  }\r\n  // 重写 wx 原生类\r\n  overideWxClass(sdk, nativeWX)\r\n\r\n  isInitComplete = true\r\n  return sdk\r\n}"],"names":["Router","constructor","sdk","warn","message","isWarn","console","Error","assert","condition","error","isUndef","v","undefined","callHook","hooks","name","params","apply","createWraper","target","fn","args","isPlainObject","obj","proto","Object","getPrototypeOf","baseProto","SDK","opts","reportStack","depComponents","Map","router","timeStack","create","time","type","Date","now","timeEnd","duration","report","key","payload","setTimeout","push","getCurrentPagePath","pages","getCurrentPages","Array","isArray","length","route","handleRouter","routerType","fail","success","info","to","url","from","rewrite","onLoad","currentComponent","SDKConfig","isPage","onLoadFns","hasOwnProperty","onShow","onShowFns","SDKCfgNamespace","overideComponent","config","canProcessCfg","nativeLoad","nativeOnShow","nativeUnload","onUnload","set","delete","unLoad","lifetimes","nativeAttached","attached","nativeDetached","detached","load","overideApp","nativeShow","nativeHide","onHide","nativeError","onError","errMsg","overideWxClass","nativeWX","overideClass","overideWX","wx","assign","isInitComplete","nativeApp","App","nativePage","Page","nativeComponent","Component","filterOpts","call"],"mappings":"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"}