"use strict";const warn$1=(e,t)=>{if(e=`\n[ReportSDK warn]: ${e}\n\n`,t)return console.warn(e),void console.log(121);throw new Error(e)},assert=(e,t)=>{e&&warn$1(t)},isUndef=e=>null==e,callHook=(e,t,n)=>e&&"function"==typeof e[t]?[!0,e[t].apply(e,n)]:[!1,null],createWraper=(e,t)=>(function(...n){if(t.apply(this,n),"function"==typeof e)return e.apply(this,n)}),isPlainObject=e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n};class SDK{constructor(e){this.opts=e,this.hooks=e.hooks,this.depComponents=new Map,this.timeStack=Object.create(null)}time(e){"string"==typeof e&&isUndef(this.timeStack[e])&&(this.timeStack[e]=Date.now())}timeEnd(e,t){if("string"==typeof e&&!isUndef(this.timeStack[e])){const n=Date.now()-this.timeStack[e];return"function"==typeof t&&t(n),this.timeStack[e]=null,n}return null}report(e,t){const[n,o]=callHook(this.hooks,"report",[e,t]);return assert(!n,"The [report] hooks is not defined."),o}}var overideWX=(e,t)=>{t("navigateTo",(function(){}))};const SDKCfgNamespace="SDKConfig";function overideComponent(e,t,n){const o=t[SDKCfgNamespace],i=isPlainObject(o);if(n){const n=t.onLoad,r=t.onUnload;t.onLoad=createWraper(n,(function(){e.depComponentData.set(this,!0),i&&(this[SDKCfgNamespace]=o)})),t.onUnload=createWraper(r,(function(){e.depComponentData.delete(this),i&&(this[SDKCfgNamespace]=null)}))}else{t.lifetimes=t.lifetimes||{};const n=t.attached||t.lifetimes.attached,r=t.detached||t.lifetimes.detached;t.attached=t.lifetimes.attached=createWraper(n,(function(){e.depComponents.set(this,!1),i&&(this[SDKCfgNamespace]=o)})),t.detached=t.lifetimes.detached=createWraper(r,(function(){e.depComponents.delete(this),i&&(this[SDKCfgNamespace]=null)}))}return t}function overideApp(e,t){const n=t.onShow,o=t.onHide,i=t.onError,r=t.onLaunch;return t.onLaunch=createWraper(r,(function(){const t=e.timeEnd("startTime");e.report("startTime",t)})),t.onShow=createWraper(n,(function(){e.time("showTime")})),t.onHide=createWraper(o,(function(){const t=e.timeEnd("showTime");e.report("showTime",t)})),t.onError=createWraper(i,(function(t){e.report("globalCatchError",t)})),t}function overideWxClass(e,t){const n={};overideWX(e,(e,o)=>{assert(!(e in t),"Only allowed to rewrite."),assert(e in n,`${e} has been rewritten`),n[e]=createWraper(t[e],o)}),wx=Object.assign({},t,n)}let isInitComplete=!1;const nativeWX=wx,nativeApp=App,nativePage=Page,nativeComponent=Component,filterOpts=e=>e;function index(e){isInitComplete&&warn("Can't allow repeat initialize.");const t=new SDK(filterOpts(e));return t.time("startTime"),Page=function(e){return e=overideComponent(t,e,!0),nativePage.call(this,e)},Component=function(e){return e=overideComponent(this,t,e),nativeComponent.call(this,e)},App=function(e){return e=overideApp(this,t),nativeApp.call(this,e)},overideWxClass(t,nativeWX),isInitComplete=!0,t}module.exports=index;
//# sourceMappingURL=wxsdk.min.js.map
