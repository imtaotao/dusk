"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var warn=function(e,t){if(e="\n[SDK warn]: "+e+"\n\n",!t)throw new Error(e);console.warn(e)},assert=function(e,t){e||warn(t)},isUndef=function(e){return null==e},once=function(e){var t=!0;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];if(t)return t=!1,e.apply(this,n)}},mapObject=function(e,t){var n={};for(var o in e)n[o]=t(o,e[o]);return n},createWraper=function(e,t,n){return function(){for(var o,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return"function"==typeof t&&t.apply(this,i),"function"==typeof e&&(o=e.apply(this,i)),"function"==typeof n&&n.apply(this,i),o}},pageLifeTime="onLoad,onShow,onReady,onHide,onUnload",componentLifeTime="created,attached,ready,moved,detached",appLifeTime="onLaunch,onShow,onHide,onError,onPageNotFound";function injectToComponent(e,t){mapObject(t,(function(t,n){e[t]=n}))}function dispatch(e,t,n,o,i){if("onLoad"===e||"attached"===e){injectToComponent(n,{dusk:t}),t.depComponents.set(n,o);var r=n.setData;n.setData=function(e,n){r.call(this,e,createWraper(n,(function(){t.emit("setData",[e])})))}}"onUnload"!==e&&"detached"!==e||t.depComponents.delete(n),t.emit(e,[n,i,o])}function overideApp(e,t){return appLifeTime.split(",").forEach((function(n){t[n]=createWraper(t[n],(function(t){e.emit(n,[this,t])}))})),t}function overidePage(e,t){return pageLifeTime.split(",").forEach((function(n){t[n]=createWraper(t[n],(function(t){dispatch(n,e,this,!0,t)}))})),t}function overideComponent(e,t){t.lifetimes=t.lifetimes||{};return componentLifeTime.split(",").forEach((function(n){var o;!function(e,n){t[e]=t.lifetimes[e]=n}(n,createWraper((o=n,t[o]||t.lifetimes[o]),(function(t){dispatch(n,e,this,!1,t)})))})),t}var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function getEventModule(e,t){return e._listener[t]||(e._listener[t]={once:[],normal:[]})}var Event=function(){function e(){this._listener=Object.create(null)}return e.prototype.on=function(e,t){return("string"==typeof e||"function"==typeof t)&&(getEventModule(this,e).normal.push(t),!0)},e.prototype.once=function(e,t){return("string"==typeof e||"function"==typeof t)&&(getEventModule(this,e).once.push(t),!0)},e.prototype.off=function(e,t){var n=this._listener[e];if(n){if("function"==typeof t){var o=-1,i=n.once,r=n.normal;~(o=i.indexOf(t))&&i.splice(o,1),~(o=r.indexOf(t))&&i.splice(o,1)}else void 0===t&&(n.once=[],n.normal=[]);return!0}return!1},e.prototype.offAll=function(){this._listener=Object.create(null)},e.prototype.emit=function(e,t){var n=this;void 0===t&&(t=[]);var o=this._listener[e];return!!o&&(o.once.forEach((function(e){return e.apply(n,t)})),o.once=[],o.normal.forEach((function(e){return e.apply(n,t)})),!0)},e}(),Router=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Event),NetWork=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Event);function expandExtrcMethods(e,t,n){function o(t){e.Template.acceptDuskEvent(this,t,n)}n?t.duskEvent=o:t.methods?t.methods.duskEvent=o:t.methods={duskEvent:o}}var Template=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.acceptDuskEvent=function(e,t,n){var o=t.type,i=t.target.dataset,r=i.duskvalue||i.duskValue;console.log(t),console.log(t.mark),r&&this.emit("event",[o,r,function(){return{isPage:n,event:t,component:e}}])},t}(Event),Dusk=function(e){function t(t){var n=e.call(this)||this;return n.version="0.0.1",n.Router=new Router,n.NetWork=new NetWork,n.Template=new Template,n.types=[],n.timeStack=Object.create(null),n.depComponents=new Map,n.installedPlugins=new Set,n.Utils={once:once,createWraper:createWraper},n.options=t,n}return __extends(t,e),t.prototype.report=function(e,t){assert(this.types.includes(e),"The ["+e+"] is not rigister."),this.emit("report",[e,t])},t.prototype.addPlugin=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return assert(!this.installedPlugins.has(e),"Don't repeat install plugin"),t.unshift(this),this.installedPlugins.add(e),e.apply(null,t)},t.prototype.time=function(e){"string"==typeof e&&isUndef(this.timeStack[e])?this.timeStack[e]=Date.now():warn("Timer ["+e+"] already exists.",!0)},t.prototype.timeEnd=function(e,t){if("string"==typeof e){var n=this.timeStack[e];if(!isUndef(n)){var o=Date.now()-n;return"function"==typeof t&&t(o),this.timeStack[e]=null,o}}return warn("Timer ["+e+"] already exists."),null},t}(Event),nativeWX=wx;function overiddenWX(e,t){"reLaunch,switchTab,navigateTo,redirectTo".split(",").forEach((function(n){t(n,(function(t){e.Router.emit(n,[t])}))}))}function overiddenWX$1(e){var t={};overiddenWX(e,(function(e,n){assert(e in nativeWX,"Can't allowed add new method."),assert(!(e in t),"["+e+"] has been rewritten"),t[e]=createWraper(nativeWX[e],n)})),wx=Object.assign({},nativeWX,t)}var nativeApp=App,nativePage=Page,nativeComponent=Component,isInitComplete=!1;function createDuskInstance(e){assert(!isInitComplete,"Can't allow repeat initialize."),isInitComplete=!0;var t=new Dusk(e);return Page=function(e){return e=overidePage(t,e),t.emit("pageCreateBefore",[e]),expandExtrcMethods(t,e,!0),nativePage.call(this,e)},Component=function(e){return e=overideComponent(t,e),t.emit("ComponentCreateBefore",[e]),expandExtrcMethods(t,e,!1),nativeComponent.call(this,e)},App=function(e){return e=overideApp(t,e),t.emit("appCreateBefore",[e]),expandExtrcMethods(t,e,!0),nativeApp.call(this,e)},overiddenWX$1(t),t}exports.createDuskInstance=createDuskInstance;
